<h2 class="entrytitle">Seventh week (July 14th, 2017)</h2>

<h3><bold>Move some target-specific functions to general GSL generator</bold></h3>
<p type="entrytext">
	Many of the target language specific generator functions were overlapping with only syntax specific differences. The result is <a href="https://github.com/CharleeSF/brian2/commit/e22ec775fbde41968ca64ba2ed0e09e8f5cf687d" target="_blank">this</a>.
</p>

<h3><bold>Change vector code translation to only use to_replace dictionary</bold></h3>
<p type="entrytext">
	Whereas first I was looping over all the vector code and changing some stuff depending on some if statements I realized this wasn't necessary if I added certain key-value combinations to the to_replace dictionary.. I'm not sure if this is more or less foolproof, but for now it seems to work.
	Examples of the things that I added to to_replace are:
	<div class="code"><code>key:
const double v = _array_neurongroup_v[_idx];
value:
const double v = y[0];

key:
const double _gsl_v_f0
value:
f[0]
	</code></div>
I could imagine a risk of this is that you need the code to be very consistent, i.e. if there is a space extra somewhere it doesn't work anymore.. Not sure if this will be an issue! 
<a href="https://github.com/CharleeSF/brian2/commit/e22ec775fbde41968ca64ba2ed0e09e8f5cf687d" target="_blank">Code.</a>
</p>

<h3><bold>Sending GSL code to templater as 'support_code_lines' instead of vector_code['GSL']</bold></h3>
<p class="entrytext">
	Trying to extend the code to work in cpp_standalone mode went pretty well just using the GSLWeaveCodeGenerator. I ran into two small issues:
	with cpp_standalone Brian replaces all contants with their value. Since we were adding Constants to the dataholder struct (e.g. p.b = b in main()) and pulling them out in func (e.g. p->b) this resulted in for example the following code:
	<div class="code"><code>p.1.2 = 1.2;</code></div> and <div class="code"><code>p->1.2</code></div>.
	This was easily solved by checking for each variable is Contant and if we use cpp_standalone (come to think of it, it might be handy to just set a value for whether we use cpp_standalone in the beginning instead of doing this for every variable..... I'll do that next week).
	<a href="https://github.com/CharleeSF/brian2/commit/85354e200747782dc812d4d21aa422c2ae130134" target="_blank">Code.</a>
</p>
<p class="entrytext">
	Another issue I ran into is that with the standalone the templater 'ignored' the support_code block that I added the vector_code['GSL'] statement to. However, just adding the code straight up to the support_code_lines made everything work (all that was left was change the support_code keyword to support_code_lines in cython). (and I had to make sure every line of code was it's own list element). 
	<a href="https://github.com/CharleeSF/brian2/commit/a0b48e2cff5ade38e86517229c2f3a45bbb069e4" target="_blank">Code.</a>
</p>
<h3><bold>Added method_options to neurongroup</bold></h3>
<p code="entrytext">
	I'll talk about this next week, seeing that I have to celebrate the weekend!
</p>