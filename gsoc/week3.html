        <h2 class="entrytitle">Third week (June 16th, 2017)</h2>
        <h3><bold>Rewriting template functions using Variables dictionary</bold></h3>
        <p type="entrytext">
        After Marcel had a look at my code he said it would be possible to improve it to use the information available to each variable in the variable dictionary. That this dictionary is available in this namespace was new to me (the whole templating system remains a bit mysterious to me). This makes things a lot easier! I now have access to all variables and their types, allowing me to easily find the datatypes and array_names. The only regex expression I need is to identify the _gsl_{var}_f{ind} variables I used to signify the places where we need GSL-specific syntax. The rewritten functions look much better as can be seen <a href="https://github.com/brian-team/brian2/blob/fdbf536a0b9afd0959aee147ba157a1fc68768bb/brian2/codegen/templates.py" target="_blank">here</a> (although improvements are always possible, they will come, don't worry).
        Except...
        </p>
        <p type="entrytext">
        All the data sent to the function that describes the differential system is sent in a parameters struct. I define the parameters struct based on the information available in dictionary of Variables. Here the datatype, dimensions and whether a variable is an array or not etc. is saved. This works great, however, the variables defined by brian itself to achieve loop invariant optimization are not saved in the variables dict. Unfortunately, it seems like no information about these variables is saved at all, except for the string that describes the statement, in the scalar_code variable, and in the case of cython, the datatype isn't even mentioned in this string. Because of this issue, it seems like we have to change a few things in the code generation process, which means that we have to make our own CodeObject and CodeGenerator classes.
        </p>
        <h3><bold>Defining GSLCodeObject and GSLCodeGenerator</bold></h3>
        <p type="entrytext">
        This was actually less difficult than what I thought at first. Although, I haven't tried to change anything about the code generation process yet. All I have done is create a new folder GSLCython_rt and copied the complete templates folder (except using our own stateupdater.pyx instead of the one normally used by brian). Now we can tell the Templater class (defined in the CodeObject) to find it's templates in this folder, while we define the generator_class to be our GSL generator. For the rest, all methods are currently still directly inherited from the cython code generation classes (<a href="https://github.com/brian-team/brian2/commit/63b4415dc25c63cf35620755c9c2276ad2772673" target="_blank">this</a> is the commit). Now the challenge is to find the nicest spot to extract and save the _lio information. (NB: turning off loop-invariant-optimization creates running <a href="https://github.com/brian-team/brian2/commit/bdd8bab241c389f2483b93ed093dd14b587874f0" target="_blank">code</a>! (after removing the nogil flags from the used functions, because int_ would not work with nogil))
        </p>
